MathJax.Hub.Config({tex2jax:{inlineMath:[["$","$"],["\\(","\\)"]],processEscapes:!0}}),MathJax.Hub.Configured();var SearchApp=angular.module("SearchApp",["ngRoute","angular-bootstrap-select","angular-inview","ui.bootstrap"]);SearchApp.config(function($routeProvider){$routeProvider.when("/",{controller:"SearchController",templateUrl:"static/js/app/views/search.html"}).when("/settings",{controller:"SettingsController",templateUrl:"static/js/app/views/settings.html"}).when("/topic",{controller:"TopicController",templateUrl:"static/js/app/views/topic.html"}).when("/ratings",{controller:"RatingsController",templateUrl:"static/js/app/views/ratings.html"}).otherwise({redirectTo:"/settings"})}),SearchApp.run(function($rootScope){$rootScope.settings={participant_id:"",exploration_rate:0,query_time:15,query_iterations:5,article_count:20},$rootScope.experiment_data={articles:[],query:null,classifier_value:null}}),SearchApp.filter("strip_tags",function(){return function(text){return String(text).replace(/<[^>]+>/gm,"")}}),SearchApp.filter("html",function($sce){return function(input){return $sce.trustAsHtml(input)}}),SearchApp.filter("ellipsis",function(){return function(text,size){return String(text).length<size?text:String(text).substring(0,size)+"..."}}),SearchApp.filter("synopsis",function(){return function(text){return String(text).length>300?String(text).substring(0,300)+"...":String(text)}});var UI=function(){var highlight_colors=[{name:"Green",rgb:"74,201,112"},{name:"Orange",rgb:"233,137,49"},{name:"Red",rgb:"235,64,59"},{name:"Turquoise",rgb:"42,176,197"},{name:"Blue",rgb:"34,127,176"}],back_to_top=function(){return $("html, body").scrollTop(0),!1},search_state=function(callback){$(".mean-bar").fadeOut(300),$(".bookmark-history-display").hide(),$("#search-results").fadeOut(300,function(){$("#search-form-container").slideDown(),$("#search-form-container input[type='text']").focus(),callback()})},end_search_state=function(){$("#search-form-container").slideUp(),back_to_top()},loading_state=function(callback){$(".layer").fadeIn(300),$("body").css("cursor","wait"),$("#search-results").fadeOut(300,function(){callback()})},end_loading_state=function(){$(".bookmark-history-display").hide(),$(".layer").fadeOut(300),$("body").css("cursor","default"),$("#search-results").fadeIn(300)},display_mean_and_variance=function(){$(".mean-bar").fadeIn(300),$.each($(".mean-bar .progress-bar"),function(i,el){width=parseFloat($(el).attr("data-mean"))/(parseFloat($(el).attr("data-mean"))+parseFloat(parseFloat($(el).attr("data-variance")))),anim={width:100*width+"%"},$(el).animate(anim,2500,"easeOutCubic"),$(el).parent().tooltip({title:Math.round(100*width)+"% based on previous selections, "+Math.round(100*(1-width))+"% variation"})})},un_highlight=function(text){return String(text).replace(/<[^>]+>/gm,"")},highlight=function(text,keywords,color){for(var content_words=String(text).split(" "),i=0;i<content_words.length;i++)keywords[content_words[i].toLowerCase()]&&(weight=keywords[content_words[i].toLowerCase()],description="",weight<.3?description="Light weighted keyword":weight>=.3&&weight<.7?description="Medium weighted keyword":description="Heavy weighted keyword",content_words[i]="<span class='word-weight animated bounceIn' data-toggle='tooltip' data-placement='top' title='"+description+"' style='background-color: rgba("+color+","+weight+"); border-bottom: 1px solid rgb("+color+")'>"+content_words[i]+"</span>");return content_words.join(" ")};return{search_state:search_state,end_search_state:end_search_state,loading_state:loading_state,end_loading_state:end_loading_state,highlight:highlight,un_highlight:un_highlight,highlight_colors:highlight_colors,back_to_top:back_to_top,display_mean_and_variance:display_mean_and_variance}}();$(document).on("ready",function(){UI.search_state(function(){}),$("#back-to-top").on("click",function(){UI.back_to_top()}),$(".bookmark-info").live("mouseenter",function(){$(this).stop().animate({bottom:15},300)}),$(".bookmark-info").live("mouseleave",function(){$(this).stop().animate({bottom:0},300,"easeOutCubic")}),$(".bookmark-history-display-trigger").live("click",function(e){e.preventDefault(),$(".history-articles .bookmark").popover({trigger:"manual",html:!0}).on("mouseenter",function(){var _this=this;$(this).popover("show"),$(".popover").on("mouseleave",function(){$(_this).popover("hide")})}).on("mouseleave",function(){var _this=this;$(".popover:hover").length||$(_this).popover("hide"),setTimeout(function(){},100)})}),$("#article-count").selectpicker(),$("#highlight-color").selectpicker(),$("#back-to-top").removeAttr("disabled"),$("#explain-search-results-modal").draggable(),$(".color-palet-divider").tooltip()}),$(document).on("scroll",function(){var scrollAmount=$(window).scrollTop(),documentHeight=$(document).height(),scrollPercent=scrollAmount/documentHeight*100;scrollPercent>0?$("#back-to-top").animate({bottom:0},400):$("#back-to-top").clearQueue().animate({bottom:-45},400)}),SearchApp.directive("exploitation",function(){return{link:function(scope,elem,attrs){var width=scope.result.mean/(scope.result.mean+scope.result.variance)*100;$(elem).css("width",width+"%")}}}),SearchApp.directive("keywordChart",function(){return{scope:{data:"=ngModel"},link:function(scope,elem,attrs){var data={labels:scope.data.labels,datasets:[{fillColor:"rgba(0,151,207,0.2)",strokeColor:"rgba(0,151,207,1)",pointColor:"rgba(0,151,207,1)",pointStrokeColor:"#fff",pointHighlightFill:"#fff",pointHighlightStroke:"rgba(0,151,207,1)",data:scope.data.values}]};new Chart($(elem)[0].getContext("2d")).Radar(data,{scaleOverride:!0,scaleSteps:10,scaleStepWidth:10,scaleStartValue:0})}}}),SearchApp.directive("mathjaxBind",function(){return{restrict:"A",controller:["$scope","$element","$attrs",function($scope,$element,$attrs){$scope.$watch($attrs.mathjaxBind,function(texExpression){$element.html(texExpression),MathJax.Hub.Queue(["Typeset",MathJax.Hub,$element[0]])})}]}}),SearchApp.directive("rate",function(){return{scope:{rating:"=ngModel"},template:'<ul class="list-inline star-list"><li data-pos="1"><i class="fa fa-star"></i></li><li data-pos="2"><i class="fa fa-star"></i></li><li data-pos="3"><i class="fa fa-star"></i></li><li data-pos="4"><i class="fa fa-star"></i></li><li data-pos="5"><i class="fa fa-star"></i></li></ul><p class="text-muted rating-helper"></p>',link:function(scope,elem,attrs){var highlight_stars=function(end){$(elem).find(".star-list .fa-star").removeClass("active");for(var i=1;end>=i;i++)$(elem).find(".star-list li[data-pos="+i+"] .fa-star").addClass("active")},helper_text=function(value){return 1==value?"This article wasn't at all relative to me.":value>1&&5>value?"This article was quite relative to me.":"This article was very relative to me."};scope.$watch("rating",function(value){highlight_stars(value),$(elem).find(".rating-helper").html(helper_text(value))}),$(elem).find(".star-list li").on("mouseover",function(){var star_pos=parseInt($(this).data("pos"));$(elem).find(".rating-helper").html(helper_text(star_pos)),highlight_stars(star_pos)}).on("click",function(){var star_pos=parseInt($(this).data("pos"));scope.$apply(function(){scope.rating=star_pos})}).on("mouseout",function(){highlight_stars(scope.rating)})}}}),SearchApp.directive("result",function(){return{link:function(scope,elem,attrs){var header_height=210,items_on_screen=7,result_height=($(window).height()-header_height)/items_on_screen;$(elem).css("height",result_height+"px"),$(window).on("resize",function(){var result_height=($(window).height()-header_height)/items_on_screen;$(elem).css("height",result_height+"px")})}}}),SearchApp.directive("topicsDiagram",function(){var BAR_HEIGHT=10,CANVAS_WIDTH=$("#topics-container").width(),COLORS=["#7fdfc6","#ebaf95","#d0fab7","#99a7dd","#cf94a4","#ef8be3","#c58784","#b7c6b5","#e7f9b1","#c3aff1","#84c7b0","#f88bcb","#dffeca","#859dce","#7f8fdf","#eba78e","#f7eedc","#ef8e9e","#c6f6df","#ed86da","#ddd690","#a4d6cd","#af8ea4","#bfa8da","#f7daea","#b3dbc0","#9791d6","#afb8e0","#abebad","#d7b7eb","#ddf9b5","#87ada0","#cb88ed","#9fa9ad","#f6efed","#869588","#e0de94","#97d0a3","#c5acca","#bca4ad","#c6a79c","#c59df4","#afade3","#8ee2e9","#e6edb6","#b7df87","#b6f9a1","#f0c08f","#baba83","#e0aa9d","#f498c0","#8a9ca3","#89a4cc","#b0b790","#d88496","#e29ee4","#90c0ca","#f4be8d","#e2a1a6","#b3a3ce","#a5c49b","#97aac2","#aee1a8","#8a8fb8","#82bdb6","#fdcbae","#faccef","#98e2d7","#cae6af","#ba97a4","#c2a296","#eaf4b6","#f8f0c4","#f9b58d","#f1d8a4","#9a89ce","#a8ddb0","#ea85f6","#9f91e4","#9cb5b3","#d49ccb","#a1dbc2","#93e6c8","#edb0fa","#e5a198","#a4c5f2","#b4e2b5","#add8fc","#f8e3bf","#cef9aa","#e39dda","#e8ee88","#868eaa","#e7babb","#8c87f4","#8ca7c5","#9cedbb","#c7d9f2","#87cac3","#bdd7d5","#a1f7b2","#abedf5","#bd8a96","#d7a5de","#ec8cbd","#82d7c2","#bbb9c9","#beb1fb","#eba5a7","#85f097","#a8f59e","#86e9b9","#cfd4eb","#edeac9","#cf8898","#f199d0","#84e685","#a5e1fc","#c0dbf0","#81fdc6","#93b38d","#a5f9c0","#8ff78e","#dea9c7","#c0a8af","#86c7a9","#aac1e8","#ebfed5","#8996dd","#aeebd4","#cab5c5","#a197ac","#c8f0e8","#b4f6f9","#a1dcdf","#e4edd3","#b38296","#93f4d1","#c6d5bc","#de8fd5","#d7e285","#c6ddf7","#c08481","#c5aac5","#abf992","#9cddd7","#ead7be","#ef9c95","#c78695","#a7aec9","#dc96bc","#efc39f","#b0afbd","#c9808b","#b98fd2","#a48fc0","#8399ef","#958db1","#c4f283","#e4da9f","#cfbcda","#8ce9e4","#b59481","#9ff3ce","#a5f49c","#b4ecd8","#d789d6","#f4fcfc","#c39c9a","#97b6d4","#f1dceb","#fdd5b3","#c599c7","#cd8a9b","#90d693","#90fad8","#c4ccdb","#9ac287","#badedd","#8e95b0","#eb8cfc","#e4efce","#a39acc","#bae388","#a7a8b8","#e68bd0","#cd9080","#f6cefb","#d6ef8c","#faa8f0","#a0d9dc","#ecdbda","#ca998a","#a8a1d1","#d0f7a1","#e1e2c0","#efc4a2","#e3d98c","#ecb5b6","#adbdb8","#e2e9b8","#dcbb83","#c4d9f1","#c7cf91","#c5edb4","#c497ec","#c6efdf","#e188fe","#e9a9d3","#899891","#d6ecf0","#a7b89a","#a3a780","#ee84b8","#e6e2ef","#eab4b3","#8b98f5","#89f4f3","#95f6a2","#92fcd9","#f1da88","#d9bbc7","#b48da6","#bfbcb3","#87cebb","#ae85d7","#b2e18b","#9790f9","#a7af8f","#b7db96","#df9cbc","#ecc0b3","#a7e888","#f2fe99","#8b84d1","#a89dda","#ac81b5","#abfadb","#927fc5","#ddb786","#8896aa","#82d9a3","#dbdab4","#d2f58e","#d9edf4","#de88ef","#cd8d85","#94dfa9","#8196d2","#bc98ae"],topics_to_color={},color_iterator=0,y_pointer=0,darken_color=function(color,percent){var num=parseInt(color.slice(1),16),amt=Math.round(2.55*percent),R=(num>>16)+amt,G=(num>>8&255)+amt,B=(255&num)+amt;return"#"+(16777216+65536*(255>R?1>R?0:R:255)+256*(255>G?1>G?0:G:255)+(255>B?1>B?0:B:255)).toString(16).slice(1)},generate_color=function(){var color=COLORS[color_iterator];return color_iterator++,color},show_tooltip=function(title,event){var $tooltip=$("#topic-tooltip");$tooltip.html(title),$tooltip.css({left:event.clientX-($tooltip.outerWidth()+10)+"px",top:event.clientY+10+"px"}),$tooltip.show()},hide_tooltip=function(){var $tooltip=$("#topic-tooltip");$tooltip.hide()},create_bar=function(raphael,data,options){var bar=raphael.rect(0,options.y,0,options.height).data("topic",data).attr({fill:options.color,"stroke-width":"0px"}).animate({width:options.width,x:options.x},500,"<");bar.mousemove(function(event){show_tooltip(data.label,event)}).mouseover(function(){bar.attr("fill",darken_color(options.color,-10))}).mouseout(function(){hide_tooltip(),bar.attr("fill",options.color)})},init_diagram=function(raphael,data,options){var all_topics=_.chain(data).reduce(function(all,article){return all.concat(article.topics)},[]).uniq(function(topic){return topic.label}).map(function(topic){return topics_to_color[topic.label]||(topics_to_color[topic.label]=generate_color()),topic.label}).value(),previousTopics=null,bar_y=y_pointer;data.forEach(function(article){article.topics.sort(function(a,b){return all_topics.indexOf(a.label)-all_topics.indexOf(b.label)}),previousTopics=_.map(article.topics,function(t){return t.label});var weight_sum=_.sum(article.topics,"weight"),bar_x=0;article.topics.forEach(function(topic){var topic_weight=topic.weight,bar_width=topic_weight/weight_sum*CANVAS_WIDTH;console.log(bar_width),create_bar(raphael,{label:topic.label},{color:topics_to_color[topic.label],width:bar_width,height:BAR_HEIGHT,x:bar_x,y:bar_y}),bar_x+=bar_width}),bar_y+=BAR_HEIGHT}),y_pointer+=BAR_HEIGHT*data.length};return{scope:{data:"=ngModel"},link:function(scope,elem,attrs){var raphael;scope.$watch("data",function(data){if(data){if(data.append){var $svg=$(elem).find("svg");$svg.attr("height",$svg.height()+data.topics.length*BAR_HEIGHT)}else y_pointer=0,$svg=$(elem).find("svg").remove(),raphael=Raphael(elem[0],CANVAS_WIDTH,1e3);data.topics&&(console.log(data.topics),init_diagram(raphael,data.topics,{}))}})}}}),SearchApp.service("Api",function($http,QueryService){function parseIterationData(options){return{selected:_.chain(options.results).where({bookmarked:!0}).map(function(bookmark){return bookmark.id}).value(),participant_id:options.participant_id,clicked:_.chain(options.results).where({clicked:!0}).map(function(clicked){return{id:clicked.id,reading_started:clicked.reading_started.getTime()/1e3,reading_ended:clicked.reading_ended.getTime()/1e3}}).value(),seen:_.chain(options.results).where({seen:!0}).map(function(seen){return seen.id}).value()}}this.next=function(options){var params=parseIterationData(options);return(0==options.exploratory||1==options.exploratory)&&(params.exploratory=options.exploratory),$http.post("/next",params)},this.search=function(options){var year_range=QueryService.getYearRange();return $http.get("/query",{params:{q:options.keyword,"article-count":options.count,participant_id:options.participant_id,year_from:year_range.from,year_to:year_range.to}})},this.setup=function(options){return $http.get("/setup",{params:{participant_id:options.participant_id,q:options.q,article_count:options.article_count,exploration_rate:options.exploration_rate}})},this.end=function(options){var params=parseIterationData(options);return $http.post("/end",params)},this.topics=function(options){return $http.get("/topics",{params:options})},this.ratings=function(data){return $http.post("/ratings",data)}}),SearchApp.service("Classifier",function(){this.is_exploratory=function(options){var query_length=options.query_length,reading_time=options.reading_time,cumulative_clicks=options.clicks_count;options.seen_count,options.query_duration;return Exploratory=!0,4>query_length?131>=reading_time?0>=cumulative_clicks?Exploratory=!0:cumulative_clicks>0&&(Exploratory=!1):reading_time>131&&(3>=query_length?Exploratory=!0:query_length>3&&(2>=cumulative_clicks?Exploratory=!0:cumulative_clicks>2&&(Exploratory=!1))):query_length>=4&&(Exploratory=!1),Exploratory}}),SearchApp.factory("QueryService",function($location){function setYearRange(range){year_range={from:range.from||year_range.from,to:range.to||year_range.to}}function getYearRange(){return year_range}function setQuery(q){query=q}function getQuery(){return query}var year_range={from:1993,to:2100},query="",service={setYearRange:setYearRange,getYearRange:getYearRange,getQuery:getQuery,setQuery:setQuery};return service}),SearchApp.service("Utils",function(){this.keywordsToChartData=function(keywords){var labels=_.map(keywords,function(keyword){return keyword.content}),values=_.map(keywords,function(keyword){return Math.round(100*keyword.weight)});return{labels:labels,values:values}}}),SearchApp.controller("RatingsController",function($scope,$rootScope,$location,Api){$rootScope.settings&&$rootScope.settings.participant_id||$location.path("/settings"),$scope.save_ratings=function(){var ratings=_($rootScope.experiment_data.articles).map(function(article){return{title:article.title,rating:article.rating}});Api.ratings({participant_id:$rootScope.settings.participant_id,classifier_value:$rootScope.experiment_data.classifier_value,query:$rootScope.experiment_data.query,ratings:ratings}).success(function(res){$rootScope.settings={participant_id:"",exploration_rate:0,query_iterations:3,query_time:15},$rootScope.experiment_data={articles:[],query:null,classifier_value:null},alert("Thanks for participating!"),$location.path("/settings")})}}),SearchApp.controller("SearchController",["$scope","$rootScope","$sce","$location","$interval","Api","Classifier","QueryService",function($scope,$rootScope,$sce,$location,$interval,Api,Classifier,QueryService){$scope.topics_pointer=0,$scope.chosen_highlight_color_index=0,$scope.result_count=20,$scope.bookmark_history=[],$scope.results=[],$scope.highlight_colors=UI.highlight_colors,$scope.selected_highlight_color=UI.highlight_colors[0],$scope.iteration=1;var first_iteration_started=null,keywords={};$scope.search=function(){reset_variables(),$scope.searching=!0,$scope.loading=!0,Api.search({keyword:$scope.search_keyword,count:parseInt($scope.result_count),participant_id:$rootScope.settings.participant_id}).success(function(response){$scope.results=response.articles,$scope.topics=response.topics,$scope.sections=response.sections,$scope.search_heading=$scope.search_keyword,$scope.loading=!1,init_results(),first_iteration_started=new Date}).error(function(){$scope.search_heading=$scope.search_keyword,$scope.loading=!1,$scope.results=[]})},$scope.transformers=function(tw){return tw.toString()+"%"},$scope.fontColor=function(bgColor){var R,G,B,C,L;R=parseInt(bgColor.slice(1,3),16),G=parseInt(bgColor.slice(3,5),16),B=parseInt(bgColor.slice(5,7),16),C=[R/255,G/255,B/255];for(var i=0;i<C.length;++i)C[i]<=.03928?C[i]=C[i]/12.92:C[i]=Math.pow((C[i]+.055)/1.055,2.4);return L=.2126*C[0]+.7152*C[1]+.0722*C[2],L>.179?"black":"white"},$scope.pick_color=function(ind){var colors=["#7B241C","#CB4335","#884EA0","#1F618D","#2E86C1","#17A589","#1E8449","#D4AC0D","#D68910","#BA4A00","#c3aff1","#84c7b0","#f88bcb","#dffeca","#859dce"];return colors[ind]},$scope.toggle_bookmark_history=function(){$scope.bookmark_history_showing=!$scope.bookmark_history_showing},$scope.article_in_view=function(result){result.seen=!0},$scope.touch_article=function(article){$rootScope.experiment_data.articles.push({id:article.id,title:article.raw_title,url:article.url,rating:1}),article.clicked=!0,article.reading_started=new Date,$scope.viewed_article=article},$scope.close_article_view=function(){var now=new Date,start=$scope.viewed_article.reading_started,diff=(now.getTime()-start.getTime())/1e3;$scope.viewed_article.reading_ended=now,$scope.viewed_article.reading_time=diff,$scope.viewed_article=null},$scope.toggle_bookmark=function(result){result.bookmarked=!result.bookmarked,result.bookmarked?$rootScope.experiment_data.articles.push({id:result.id,title:result.raw_title,url:result.url,rating:1}):_($rootScope.experiment_data.articles).remove(function(article){return article.id==result.id})},$scope.next=function(){var options={results:$scope.results,participant_id:$rootScope.settings.participant_id};UI.back_to_top(),$scope.bookmark_history_showing=!1;var history_obj={iteration:$scope.iteration,articles:_.where($scope.results,{bookmarked:!0})};0!=history_obj.articles.length&&$scope.bookmark_history.push(history_obj),$scope.loading=!0,$scope.iteration==$rootScope.max_iterations?Api.end(options).success(function(){$location.path("/settings")}):Api.next(options).success(function(response){$scope.results=response.articles,$scope.sections=response.sections,$scope.topics=response.topics,$scope.loading=!1,keywords=response.keywords,init_results(),$scope.iteration++,$scope.search_heading=$scope.search_keyword,$scope.highlight_keywords&&highlight()}).error(function(){$scope.results=[],$scope.loading=!1})},$scope.back_to_top=function(){UI.back_to_top()},$scope.next_is_disabled=function(){return $scope.iteration>1||_.where($scope.results,{bookmarked:!0}).length>0?!1:!0},$scope.end=function(){if($scope.viewed_article){var now=new Date,start=$scope.viewed_article.reading_started,diff=(now.getTime()-start.getTime())/1e3;$scope.viewed_article.reading_ended=now,$scope.viewed_article.reading_time=diff}var options={results:$scope.results,participant_id:$rootScope.settings.participant_id};Api.end(options).success(function(){$location.path("/settings")})},$scope.more_topics=function(){$scope.topics_pointer+=100,$scope.loading_topics=!0,Api.topics({from:$scope.topics_pointer,to:$scope.topics_pointer+100,participant_id:$rootScope.settings.participant_id,normalise:0}).then(function(topics){$scope.visualization_data={topics:topics.data,append:!0},$scope.loading_topics=!1})},$scope.toggle_highlight=function(){$scope.highlight_keywords=!$scope.highlight_keywords,$scope.highlight_keywords?highlight():un_highlight()},$scope.show_full_abstract=function(result){result.abstract_synopsis=result["abstract"],result.full_length_abstract=!0},$scope.bookmarked_results=function(result){return 1==result.bookmarked},$scope.toggle_plain_abstract=function(result){result.show_plain_abstract=!result.show_plain_abstract};var un_highlight=function(){$scope.results.forEach(function(result){result["abstract"]=$sce.trustAsHtml(UI.un_highlight(result["abstract"])),result.abstract_synopsis=$sce.trustAsHtml(UI.un_highlight(result.abstract_synopsis)),result.title=$sce.trustAsHtml(UI.un_highlight(result.title))})},highlight=function(){un_highlight(),$scope.results.forEach(function(result){result["abstract"]=$sce.trustAsHtml(UI.highlight(result["abstract"],keywords,$scope.selected_highlight_color.rgb)),result.abstract_synopsis=$sce.trustAsHtml(UI.highlight(result.abstract_synopsis,keywords,$scope.selected_highlight_color.rgb)),result.title=$sce.trustAsHtml(UI.highlight(result.title,keywords,$scope.selected_highlight_color.rgb))})},init_results=function(articles){$scope.results.forEach(function(result){result.bookmarked=!1,result.plain_abstract=$sce.trustAsHtml(result["abstract"]),result.title=$sce.trustAsHtml(String(result.title).replace(/<[^>]+>/gm,"")),result.raw_title=String(result.title).replace(/<[^>]+>/gm,""),result.author=$sce.trustAsHtml(result.author),result.trusted_url=$sce.trustAsResourceUrl(result.url);var synopsis=String(result["abstract"]).length>600?String(result["abstract"]).substring(0,600)+"...":String(result["abstract"]);result.abstract_synopsis=$sce.trustAsHtml(synopsis),result.full_length_abstract=String(result["abstract"]).length==String(result.abstract_synopsis).length})},reset_variables=function(){$scope.iteration=1,$scope.bookmark_history_showing=!1,$scope.bookmark_history=[],$scope.results=[],$scope.keywords={}};$scope.$watch("chosen_highlight_color_index",function(newVal,oldVal){$scope.selected_highlight_color=$scope.highlight_colors[parseInt(newVal)],highlight()}),QueryService.setYearRange({from:$location.search().year_from||1993,to:$location.search().year_to||2100}),$scope.search_keyword=QueryService.getQuery(),$scope.search_keyword&&$scope.search()}]),SearchApp.controller("SettingsController",function($scope,$rootScope,$location,Api,QueryService){$scope.setup=function(){QueryService.setQuery($rootScope.settings.search_query||""),$rootScope.max_iterations=parseInt($rootScope.settings.query_iterations),Api.setup({participant_id:$rootScope.settings.participant_id,exploration_rate:$rootScope.settings.exploration_rate,q:$rootScope.settings.search_query,article_count:$rootScope.settings.article_count}).success(function(){$rootScope.experiment_data.query=$rootScope.settings.search_query,$scope.setup_saved=!0})}}),SearchApp.controller("TopicController",function($scope,$routeParams,$location,$sce,Utils){function init_articles(){$scope.related_articles.forEach(function(article){article["abstract"]=$sce.trustAsHtml(String(article["abstract"]).replace(/<[^>]+>/gm,"")),article.title=$sce.trustAsHtml(String(article.title).replace(/<[^>]+>/gm,""));var synopsis=String(article["abstract"]).length>300?String(article["abstract"]).substring(0,300)+"...":String(article["abstract"]);article.abstract_synopsis=$sce.trustAsHtml(synopsis),article.full_length_abstract=String(article["abstract"]).length==String(article.abstract_synopsis).length})}$scope.related_articles=[],$scope.related_keywords=[];for(var i=0;10>i;i++)$scope.related_articles.push({title:"Lorem ipsum dolor sit amet","abstract":"Lorem ipsum dolor sit amet, consectetur adipiscing elit. Aenean euismod, massa ullamcorper pellentesque ultrices, nunc mauris bibendum tortor, ac ultrices urna arcu quis lectus. Quisque ut congue mi, nec dapibus nisl. Pellentesque eu risus sed velit ullamcorper sagittis. Proin posuere congue eros, in tincidunt velit dictum at. Donec posuere sodales tellus, et fringilla lectus scelerisque id. Etiam in feugiat nibh, sit amet sollicitudin erat. Morbi eget velit ac velit sodales aliquam. Suspendisse tempor nisi nec ex consequat cursus.",author:"Lorem ipsum, dolor sit",venue:"arXiv",url:"http://cs.helsinki.fi"}),$scope.related_keywords.push({weight:Math.random(),content:"Lorem ipsum"});$scope.related_keywords=Utils.keywordsToChartData($scope.related_keywords),$scope.back=function(){$location.path("/")},$scope.show_full_abstract=function(article){article.abstract_synopsis=article["abstract"],article.full_length_abstract=!0},init_articles()});